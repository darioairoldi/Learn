# Multi-Agent Orchestration Plan V2 for Prompt and Agent File Creation

**Purpose**: Comprehensive plan to break down monolithic `*-createorupdate-*-v2.prompt.md` files into robust, reliable multi-agent orchestrations with enhanced requirements validation.

**Date**: 2025-12-14  
**Version**: 2.0  
**Status**: Planning Phase

---

## Executive Summary

This plan refines the original multi-agent orchestration approach by:

1. **Separating Design/Create from Review/Validate** - Clear distinction between creation and validation workflows
2. **Adding Use Case Challenge Validation** - Goals and roles are actively tested against realistic scenarios
3. **Integrating Agent Dependency Planning** - Phases 5-6 handle agent updates and creation plans
4. **Cross-Prompt Coordination** - Agent creation plans flow to `agent-design-and-create.prompt.md`

### Files to Create/Update Summary

| Category | Create | Update | Total |
|----------|--------|--------|-------|
| **Orchestration Prompts** | 4 | 0 | 4 |
| **Agent Files** | 4 | 4 | 8 |
| **Instruction Files** | 0 | 0 | 0 |
| **Context Files** | 0 | 0 | 0 |

**Total Files**: 12 files (8 new, 4 updates)

---

## Table of Contents

- [Analysis of Source Prompts](#analysis-of-source-prompts)
- [Architecture Overview](#architecture-overview)
- [Orchestration Prompts Specifications](#orchestration-prompts-specifications)
- [Agent Specifications](#agent-specifications)
- [Instruction Files Assessment](#instruction-files-assessment)
- [Handoff Flow Diagrams](#handoff-flow-diagrams)
- [Implementation Roadmap](#implementation-roadmap)

---

## Analysis of Source Prompts

### Source 1: `prompt-createorupdate-prompt-file-v2.prompt.md`

**Current Structure** (1355 lines):
- Phase 1: Input Analysis and Requirements Gathering
  - Step 1: Determine Operation Type
  - Step 2: Extract Initial Requirements
  - Step 3: Determine Validation Depth (Adaptive)
  - Step 4: Validate Requirements (Active Challenge-Based Discovery)
    - 4.1: Challenge Goal with Use Cases
    - 4.2: Validate Role Appropriateness
    - 4.3: Verify Workflow Reliability

**Key Strengths to Preserve**:
- ‚úÖ Use case challenge validation (3/5/7 scenarios based on complexity)
- ‚úÖ Three-tier boundary system (Always Do / Ask First / Never Do)
- ‚úÖ Adaptive validation depth (Simple/Moderate/Complex)
- ‚úÖ Role appropriateness testing (Authority/Expertise/Specificity tests)
- ‚úÖ Tool composition validation

**Issues to Address**:
- ‚ùå Monolithic design (all phases in single prompt)
- ‚ùå No separation between design and validation
- ‚ùå Limited handoff orchestration
- ‚ùå Tool overload risk (needs 10+ tools for full workflow)

---

### Source 2: `agent-createorupdate-agent-file-v2.prompt.md`

**Current Structure** (1394 lines):
- Phase 1: Input Analysis and Requirements Gathering
  - Step 1: Determine Operation Type
  - Step 2: Extract Initial Requirements
  - Step 3: Determine Validation Depth (Adaptive)
  - Step 4: Validate Requirements
    - 4.1: Challenge Role with Use Cases
    - 4.2: Validate Tool Composition

**Key Strengths to Preserve**:
- ‚úÖ Role challenge with realistic scenarios
- ‚úÖ Tool composition validation (3-7 tools, agent/tool alignment)
- ‚úÖ Handoff discovery (when agent needs to delegate)
- ‚úÖ Scope boundary identification (IN/OUT of scope)
- ‚úÖ Complexity assessment for validation depth

**Issues to Address**:
- ‚ùå Same monolithic issues as prompt version
- ‚ùå No coordination with dependent agent creation
- ‚ùå Missing clear phase separation for orchestration

---

## Architecture Overview

### Design Principles

1. **Separation of Concerns**
   - Design/Create ‚Üí Requirements + Research + Build
   - Review/Validate ‚Üí Validation + Issue Resolution

2. **Narrow Tool Scope**
   - Each agent: 3-7 essential tools only
   - Prevent tool clash through specialization

3. **Clear Handoff Points**
   - User approval checkpoints at phase transitions
   - Automatic handoffs within validation loops

4. **Reusable Components**
   - Prompt agents reusable for prompt workflows
   - Agent agents reusable for agent workflows
   - Cross-pollination where appropriate

### Architecture Diagram

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                           USER REQUEST                                   ‚îÇ
‚îÇ       "Create a prompt for X" / "Create an agent for Y"                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ                               ‚îÇ
            ‚ñº                               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ PROMPT-DESIGN-AND-    ‚îÇ       ‚îÇ AGENT-DESIGN-AND-     ‚îÇ
‚îÇ CREATE                ‚îÇ       ‚îÇ CREATE                ‚îÇ
‚îÇ (Orchestrator)        ‚îÇ       ‚îÇ (Orchestrator)        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ                               ‚îÇ
            ‚îÇ Phase 1-4                     ‚îÇ Phase 1-6
            ‚îÇ                               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           ‚îÇ     RESEARCH & BUILD          ‚îÇ           ‚îÇ
‚îÇ           ‚ñº                               ‚ñº           ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê               ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ
‚îÇ   ‚îÇ   prompt-    ‚îÇ               ‚îÇ   agent-     ‚îÇ     ‚îÇ
‚îÇ   ‚îÇ  researcher  ‚îÇ               ‚îÇ  researcher  ‚îÇ     ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
‚îÇ          ‚îÇ                              ‚îÇ             ‚îÇ
‚îÇ          ‚ñº                              ‚ñº             ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê               ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ
‚îÇ   ‚îÇ   prompt-    ‚îÇ               ‚îÇ   agent-     ‚îÇ     ‚îÇ
‚îÇ   ‚îÇ   builder    ‚îÇ               ‚îÇ   builder    ‚îÇ     ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    VALIDATION                          ‚îÇ
‚îÇ                                                        ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê               ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ
‚îÇ   ‚îÇ   prompt-    ‚îÇ               ‚îÇ   agent-     ‚îÇ     ‚îÇ
‚îÇ   ‚îÇ  validator   ‚îÇ               ‚îÇ  validator   ‚îÇ     ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
‚îÇ          ‚îÇ                              ‚îÇ             ‚îÇ
‚îÇ          ‚îÇ Issues?                      ‚îÇ Issues?     ‚îÇ
‚îÇ          ‚ñº                              ‚ñº             ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê               ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ
‚îÇ   ‚îÇ   prompt-    ‚îÇ               ‚îÇ   agent-     ‚îÇ     ‚îÇ
‚îÇ   ‚îÇ   updater    ‚îÇ               ‚îÇ   updater    ‚îÇ     ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ                               ‚îÇ
            ‚ñº                               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ PROMPT-REVIEW-AND-    ‚îÇ       ‚îÇ AGENT-REVIEW-AND-     ‚îÇ
‚îÇ VALIDATE              ‚îÇ       ‚îÇ VALIDATE              ‚îÇ
‚îÇ (For standalone       ‚îÇ       ‚îÇ (For standalone       ‚îÇ
‚îÇ  validation)          ‚îÇ       ‚îÇ  validation)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## Orchestration Prompts Specifications

### 1. `prompt-design-and-create.prompt.md`

**Status**: ‚¨ú CREATE NEW (replace existing `prompt-design-and-create.prompt.md`)

**Purpose**: Orchestrate the complete design and creation workflow for new prompt files using specialized agents. Incorporates use case challenge validation from v2 monolithic prompts.

#### YAML Frontmatter

```yaml
---
name: prompt-design-and-create
description: "Orchestrate prompt file design and creation using specialized agents with use case challenge validation"
agent: agent
model: claude-sonnet-4.5
tools:
  - semantic_search
  - read_file
handoffs:
  - label: "Research prompt requirements and patterns"
    agent: prompt-researcher
    send: false
  - label: "Build prompt file from validated specification"
    agent: prompt-builder
    send: false
  - label: "Validate prompt quality and compliance"
    agent: prompt-validator
    send: true
  - label: "Fix validation issues"
    agent: prompt-updater
    send: false
argument-hint: 'Describe the prompt purpose: what task it should accomplish, expected inputs/outputs, any constraints'
---
```

#### Role Definition

```markdown
## Your Role

You are a **prompt creation workflow orchestrator** responsible for coordinating specialized agents to produce high-quality, validated prompt files.

**Your Expertise**:
- Requirements gathering and validation
- Use case challenge analysis
- Multi-agent workflow coordination
- Quality gate management

**You DO NOT**:
- Research patterns yourself (delegate to prompt-researcher)
- Create files yourself (delegate to prompt-builder)
- Validate files yourself (delegate to prompt-validator)
- Fix issues yourself (delegate to prompt-updater)
```

#### Phase Workflow

**Phase 1: Requirements Gathering**

**Goal**: Clarify what needs to be created, challenge with use cases, validate goal and role.

**Orchestrator Activities**:
1. Extract user intent from request
2. Determine prompt type (validation/implementation/orchestration)
3. Identify initial goal, role, and constraints

**Handoff to `@prompt-researcher`**:
```yaml
context: |
  User Request: [user's description]
  Initial Analysis:
    - Prompt Type: [validation/implementation/orchestration]
    - Apparent Goal: [extracted goal]
    - Apparent Role: [inferred role]
  
  YOUR TASK - Challenge Requirements:
  1. Generate 3-7 use cases to test goal clarity (based on complexity)
  2. Identify ambiguities and gaps revealed by scenarios
  3. Test role appropriateness (authority/expertise/specificity)
  4. Identify CRITICAL BOUNDARIES (Always Do/Ask First/Never Do)
  5. If additional roles needed for phases, identify them
  
  Return: Validated requirements report with refined goal, role(s), boundaries
```

**Decision Point**: User reviews and approves requirements before Phase 2

---

**Phase 2: Research and Pattern Discovery**

**Goal**: Find proven patterns from `.copilot/context/prompt-engineering/` and similar prompts.

**Handoff to `@prompt-researcher`**:
```yaml
context: |
  Validated Requirements: [from Phase 1]
  
  YOUR TASK - Pattern Discovery (LOCAL ONLY):
  1. Search `.copilot/context/prompt-engineering/` for applicable patterns
     - context-engineering-principles.md
     - tool-composition-guide.md
     - validation-caching-pattern.md
  2. Find 3-5 similar existing prompts in `.github/prompts/`
  3. Extract common patterns, tool compositions
  4. Identify anti-patterns to avoid
  5. Select appropriate template from `.github/templates/`
  
  DO NOT: Search internet, fetch external URLs
  
  Return: Pattern analysis report with template recommendation
```

**Decision Point**: User reviews patterns and approves template selection

---

**Phase 3: Prompt Structure Definition**

**Goal**: Create complete specification before file creation.

**Handoff to `@prompt-researcher`**:
```yaml
context: |
  Validated Requirements: [from Phase 1]
  Pattern Analysis: [from Phase 2]
  
  YOUR TASK - Define Complete Structure:
  1. Define YAML frontmatter (name, description, agent mode, tools, handoffs)
  2. Structure process phases with inputs/outputs
  3. Create tool justification list (3-7 tools only)
  4. Define three-tier boundaries
  5. Plan validation strategy
  6. Identify agent dependencies:
     - Existing agents this prompt will use
     - Existing agents that may need updates
     - New agents that may need to be created
  
  Return: Complete specification document
```

**Decision Point**: User approves specification before build

---

**Phase 4: Prompt File Creation**

**Goal**: Generate the prompt file following approved specification.

**Handoff to `@prompt-builder`**:
```yaml
context: |
  Approved Specification: [from Phase 3]
  Template: [recommended template path]
  
  YOUR TASK - Create Prompt File:
  1. Load recommended template
  2. Apply all customizations from specification
  3. Implement three-tier boundaries
  4. Add examples (2-3 scenarios)
  5. Add bottom metadata block
  6. Save to .github/prompts/[name].prompt.md
  
  Return: Created file path, builder self-check results
```

**Auto-Handoff**: File automatically passed to validation

---

**Phase 5: Create Plan for Agent Updates** (Optional)

**Goal**: If Phase 3 identified existing agents needing updates, create plans.

**Triggered When**: Specification includes `agents_to_update` list

**Orchestrator Activities**:
1. Review agent update requirements from specification
2. Present update plan to user
3. Upon approval, create handoff package

**Output**:
```markdown
## Agent Update Plan

### Agents Requiring Updates

**1. [agent-name].agent.md**
- **Current state**: [brief description]
- **Updates needed**: [specific changes]
- **Tools to add/remove**: [if any]
- **Boundaries to modify**: [if any]
- **Risk assessment**: [Low/Medium/High]

**2. [agent-name].agent.md**
[Same structure]

### Recommended Processing
Execute updates using: `@agent-review-and-validate` with update mode

**Approve update plan? (yes/no/modify)**
```

**Decision Point**: User approves before agent updates proceed

---

**Phase 6: Create Plan for New Agents** (Optional)

**Goal**: If Phase 3 identified new agents needed, create specifications.

**Triggered When**: Specification includes `agents_to_create` list

**Orchestrator Activities**:
1. Review new agent requirements from specification
2. Present creation plan to user
3. Upon approval, create handoff package

**Output**:
```markdown
## New Agent Creation Plan

### Agents to Create

**1. [agent-name].agent.md**
- **Purpose**: [one-sentence description]
- **Role**: [specialist persona]
- **Tools**: [3-7 tools with justification]
- **Agent mode**: [plan/agent]
- **Boundaries**: [Always/Ask/Never]
- **Handoffs**: [if orchestrates other agents]
- **Template**: [recommended template]

**2. [agent-name].agent.md**
[Same structure]

### Recommended Processing
Create each agent using: `@agent-design-and-create`

**Approve creation plan? (yes/no/modify)**
```

**Decision Point**: User approves before agent creation proceeds

---

**Phase 7: Quality Validation**

**Goal**: Comprehensive validation against all standards.

**Auto-Handoff to `@prompt-validator`**:
```yaml
context: |
  File Path: [created file path]
  Specification: [from Phase 3]
  
  YOUR TASK - Validate Prompt:
  1. Structure validation (YAML, sections, formatting)
  2. Convention compliance (naming, metadata)
  3. Pattern consistency (matches repository patterns)
  4. Quality assessment (clarity, completeness, boundaries)
  5. Tool/agent mode alignment check
  
  Return: Validation report with categorized findings
```

**Decision Point**:
- ‚úÖ **No critical issues**: Complete - prompt ready for use
- ‚ö†Ô∏è **Warnings only**: User decides to fix or accept
- ‚ùå **Critical issues**: Proceed to Phase 8

---

**Phase 8: Issue Resolution**

**Goal**: Fix validation issues systematically.

**Handoff to `@prompt-updater`**:
```yaml
context: |
  File Path: [prompt file path]
  Validation Report: [from Phase 7]
  
  YOUR TASK - Fix Issues:
  1. Parse validation report for specific issues
  2. Prioritize: Critical ‚Üí Moderate ‚Üí Minor
  3. Apply targeted fixes (include 3-5 lines context)
  4. Update metadata timestamps
  
  Return: Updated file, change summary
```

**Loop**: Return to Phase 7 for re-validation (max 3 iterations)

---

#### Boundaries

```markdown
## üö® CRITICAL BOUNDARIES

### ‚úÖ Always Do
- Gather complete requirements before any handoffs
- Challenge goals with use cases before accepting
- Wait for user approval at each phase transition
- Delegate all research/build/validate/update to specialists
- Validate files before declaring completion

### ‚ö†Ô∏è Ask First
- When requirements are ambiguous after use case challenge
- When Phase 3 identifies agent dependencies
- When validation finds critical issues (>3 iterations)

### üö´ Never Do
- NEVER skip requirements gathering (Phase 1)
- NEVER skip use case challenge validation
- NEVER build without approved specification
- NEVER skip validation phase
- NEVER implement yourself - orchestrate only
```

---

### 2. `prompt-review-and-validate.prompt.md`

**Status**: üîÑ UPDATE EXISTING (enhance current implementation)

**Purpose**: Orchestrate validation of existing prompt files and coordinate targeted improvements.

#### YAML Frontmatter

```yaml
---
name: prompt-review-and-validate
description: "Orchestrate prompt file validation, improvement, and issue resolution workflow"
agent: agent
model: claude-sonnet-4.5
tools:
  - read_file
  - semantic_search
  - grep_search
handoffs:
  - label: "Research improvement patterns and best practices"
    agent: prompt-researcher
    send: false
  - label: "Apply targeted improvements"
    agent: prompt-updater
    send: false
  - label: "Validate prompt quality"
    agent: prompt-validator
    send: true
argument-hint: 'Provide path to existing prompt file, or attach with #file, optionally describe specific concerns'
---
```

#### Phase Workflow

**Phase 1: File Analysis**
- Load and parse target prompt file
- Identify structure, type, current state
- Detect potential issues (structure, tools, boundaries)

**Phase 2: Pattern Research** (Optional)
- If improvements needed, research current best practices
- Find patterns in high-quality similar prompts

**Phase 3: Validation**
- Comprehensive validation via `@prompt-validator`
- Generate categorized report

**Phase 4: Improvement Planning**
- Analyze validation findings
- Create targeted improvement plan
- Preserve core behavior

**Phase 5: Issue Resolution**
- Apply fixes via `@prompt-updater`
- Re-validate until no critical issues

---

### 3. `agent-design-and-create.prompt.md`

**Status**: ‚¨ú CREATE NEW

**Purpose**: Orchestrate the complete design and creation workflow for new agent files. Handles agent dependency chains and role challenge validation.

#### YAML Frontmatter

```yaml
---
name: agent-design-and-create
description: "Orchestrate agent file design and creation with role challenge validation and dependency handling"
agent: agent
model: claude-sonnet-4.5
tools:
  - semantic_search
  - read_file
handoffs:
  - label: "Research agent requirements and patterns"
    agent: agent-researcher
    send: false
  - label: "Build agent file from validated specification"
    agent: agent-builder
    send: false
  - label: "Validate agent quality and compliance"
    agent: agent-validator
    send: true
  - label: "Fix validation issues"
    agent: agent-updater
    send: false
argument-hint: 'Describe the agent role and purpose: what specialist persona, what tasks it handles, any tool requirements'
---
```

#### Phase Workflow

**Phase 1: Requirements Gathering**

**Goal**: Clarify agent role, challenge with use cases, validate tool requirements.

**Handoff to `@agent-researcher`**:
```yaml
context: |
  User Request: [user's description]
  Initial Analysis:
    - Apparent Role: [inferred specialist role]
    - Apparent Mode: [plan for read-only, agent for write access]
    - Apparent Tools: [inferred from role type]
  
  YOUR TASK - Challenge Requirements:
  1. Generate 3-7 use cases to test role specialization
  2. Identify: Is role too broad? Too narrow?
  3. Discover tool requirements from scenarios
  4. Test agent/tool alignment (plan ‚Üí read-only, agent ‚Üí full access)
  5. Identify handoff needs (does agent need to delegate?)
  6. Define scope boundaries (IN SCOPE vs OUT OF SCOPE)
  7. Establish CRITICAL BOUNDARIES (Always Do/Ask First/Never Do)
  
  Return: Validated requirements with refined role, tools (3-7), boundaries
```

**Role Challenge Output Format**:
```markdown
### Role Challenge Results

**Initial Role**: [starting role definition]
**Use Cases Generated**: [3/5/7]

**Use Case 1**: [scenario]
- Test: [question about role capability]
- Result: [‚úÖ Clear / ‚ö†Ô∏è Ambiguous / ‚ùå Gap]
- Tool Discovered: [if scenario reveals tool need]
- Boundary Discovered: [if scenario reveals scope limit]
- Refinement: [specific role adjustment]

[Repeat for all use cases]

**Validation Status**:
- ‚úÖ Role appropriately specialized ‚Üí Proceed
- ‚ö†Ô∏è Role needs refinement ‚Üí [proposed changes, ask user]
- ‚ùå Role fundamentally flawed ‚Üí BLOCK, ask user for direction

**Refined Role**: [updated role definition]
**Tools Discovered**: [list with justifications]
**Handoffs Needed**: [if agent should delegate to others]
**Scope Boundaries**: IN: [list] / OUT: [list]
```

**Decision Point**: User approves requirements

---

**Phase 2: Research and Pattern Discovery**

**Goal**: Find patterns from context files and similar agents.

**Handoff to `@agent-researcher`**:
```yaml
context: |
  Validated Requirements: [from Phase 1]
  
  YOUR TASK - Pattern Discovery (LOCAL ONLY):
  1. Search `.copilot/context/prompt-engineering/` for applicable patterns
     - context-engineering-principles.md
     - tool-composition-guide.md (CRITICAL for agent tool selection)
  2. Find 3-5 similar existing agents in `.github/agents/`
  3. Extract tool composition patterns
  4. Identify successful role definitions
  5. Note anti-patterns (tool overload, broad scope)
  
  Return: Pattern analysis with tool composition recommendations
```

---

**Phase 3: Agent Structure Definition**

**Goal**: Create complete specification before file creation.

**Handoff to `@agent-researcher`**:
```yaml
context: |
  Validated Requirements: [from Phase 1]
  Pattern Analysis: [from Phase 2]
  
  YOUR TASK - Define Complete Structure:
  1. Define YAML frontmatter:
     - description (one-sentence)
     - agent mode (plan/agent)
     - tools (3-7 MAXIMUM with justification)
     - handoffs (if agent coordinates others)
  2. Define role/persona with expertise areas
  3. Structure responsibilities (primary tasks)
  4. Create three-tier boundaries
  5. Plan validation strategy
  6. Identify dependencies:
     - Existing agents this agent will hand off to
     - Existing agents that may need updates
     - New supporting agents needed
  
  CRITICAL: Tools MUST be 3-7 only. If >7 needed, decompose into multiple agents.
  
  Return: Complete specification document
```

**Decision Point**: User approves specification

---

**Phase 4: Agent File Creation**

**Goal**: Generate the agent file.

**Handoff to `@agent-builder`**:
```yaml
context: |
  Approved Specification: [from Phase 3]
  
  YOUR TASK - Create Agent File:
  1. Apply specification to agent file structure
  2. Implement persona/role definition
  3. Configure tools (MUST be 3-7)
  4. Implement three-tier boundaries
  5. Add bottom metadata block
  6. Save to .github/agents/[name].agent.md
  
  Return: Created file path, tool count verification
```

---

**Phase 5: Plan for Agent Updates**

**Goal**: If dependencies identified, create update plans.

**Same structure as prompt-design-and-create Phase 5**

---

**Phase 6: Plan for New Agent Creation**

**Goal**: If new supporting agents needed, create specifications.

**Orchestrator Activities**:
1. Review new agent specifications from Phase 3
2. Present creation plan to user
3. **Upon approval, create handoff to self (recursive)**

**Recursive Handling**:
```markdown
## New Agent Creation Queue

**Maximum recursion depth**: 2 levels (prevent infinite loops)

**Agents to Create**:
1. [agent-name] - [will be created via @agent-design-and-create]
2. [agent-name] - [will be created via @agent-design-and-create]

**Processing Order**:
1. Complete current agent creation
2. Run validation
3. If passed, process agent creation queue
4. Each queued agent triggers new @agent-design-and-create workflow

**Approve and proceed? (yes/no/modify)**
```

---

**Phase 7: Quality Validation**

**Auto-Handoff to `@agent-validator`**:
```yaml
context: |
  File Path: [created file path]
  Specification: [from Phase 3]
  
  YOUR TASK - Validate Agent:
  1. Structure validation (YAML, sections)
  2. Tool count validation (MUST be 3-7)
  3. Agent/tool alignment (plan ‚Üí read-only, agent ‚Üí write-capable)
  4. Boundary completeness (three-tier)
  5. Convention compliance
  6. Handoff validity (target agents exist)
  
  Return: Validation report with categorized findings
```

---

**Phase 8: Issue Resolution**

**Same structure as prompt-design-and-create Phase 8, using `@agent-updater`**

---

### 4. `agent-review-and-validate.prompt.md`

**Status**: ‚¨ú CREATE NEW

**Purpose**: Orchestrate validation of existing agent files with focus on tool alignment and role clarity.

#### YAML Frontmatter

```yaml
---
name: agent-review-and-validate
description: "Orchestrate agent file validation with tool alignment checks and issue resolution"
agent: agent
model: claude-sonnet-4.5
tools:
  - read_file
  - semantic_search
  - grep_search
handoffs:
  - label: "Research improvement patterns"
    agent: agent-researcher
    send: false
  - label: "Apply targeted improvements"
    agent: agent-updater
    send: false
  - label: "Validate agent quality"
    agent: agent-validator
    send: true
argument-hint: 'Provide path to existing agent file, or attach with #file'
---
```

#### Phase Workflow

**Phase 1: File Analysis**
- Load target agent file
- Parse: role, tools, mode, boundaries
- Check tool count (flag if >7)
- Check agent/tool alignment

**Phase 2: Validation**
- Comprehensive validation via `@agent-validator`
- Special focus on:
  - Tool count compliance
  - Agent mode / tool alignment
  - Boundary completeness

**Phase 3: Improvement Planning**
- Analyze validation findings
- Create targeted improvement plan
- If tool count >7, recommend decomposition

**Phase 4: Issue Resolution**
- Apply fixes via `@agent-updater`
- Re-validate until compliant

---

## Agent Specifications

### Existing Agents to UPDATE (4 files)

---

#### 1. `prompt-researcher.agent.md`

**Status**: üîÑ UPDATE - Add use case challenge capabilities

**Current File**: `.github/agents/prompt-researcher.agent.md` (604 lines)

**Updates Needed**:

| Section | Current | Add/Modify |
|---------|---------|------------|
| **Role** | Research specialist | Add "Requirements analyst" capability |
| **Phase 1** | Requirements Clarification | Add use case challenge generation |
| **New Section** | N/A | Add "Use Case Challenge Methodology" |
| **Output Templates** | Basic requirements summary | Add challenge results template |

**New Process Step to Add**:

```markdown
### Phase 1a: Use Case Challenge Validation (NEW)

**Goal**: Test goal clarity through realistic scenarios.

**Process**:
1. Determine complexity level (Simple/Moderate/Complex)
2. Generate use cases (3/5/7 based on complexity)
3. Test each scenario against goal:
   - Does goal provide clear guidance?
   - What gaps or ambiguities revealed?
   - What tools/boundaries discovered?
4. Refine goal based on findings

**Use Case Generation Guidelines**:

| Complexity | Indicators | Use Cases |
|------------|------------|-----------|
| Simple | Clear single task, standard role | 3 |
| Moderate | Multiple objectives, domain-specific | 5 |
| Complex | Broad scope, novel workflow | 7 |

**Output: Challenge Results**
```markdown
### Use Case Challenge Results

**Complexity Assessment**: [Simple/Moderate/Complex]
**Use Cases Generated**: [N]

**Use Case 1: [Common Case]**
- Scenario: [realistic situation]
- Test: [question about goal applicability]
- Current Guidance: [what goal says to do]
- Gap Identified: [ambiguity or missing info]
- Refinement: [specific change to goal]

[Repeat for all use cases]

**Validation Status**: [‚úÖ Clear / ‚ö†Ô∏è Needs Refinement / ‚ùå Critical Gaps]
**Refined Goal**: [updated goal incorporating discoveries]
```
```

---

#### 2. `prompt-builder.agent.md`

**Status**: üîÑ UPDATE - Minor enhancements

**Current File**: `.github/agents/prompt-builder.agent.md` (620 lines)

**Updates Needed**:

| Section | Current | Add/Modify |
|---------|---------|------------|
| **Tool validation** | Basic structure check | Add tool count verification (3-7) |
| **Boundaries section** | Template-based | Ensure three-tier enforcement |
| **Metadata** | Basic | Add creation context tracking |

**New Validation Step to Add**:

```markdown
### Phase 3a: Pre-Save Validation (NEW)

**Before saving file, verify**:
- [ ] Tool count: [count] (MUST be 3-7)
- [ ] Agent mode matches tool types
- [ ] Three-tier boundaries complete
- [ ] Bottom metadata block present
- [ ] Examples included (minimum 2)

**If any check fails**: STOP, report issue, do not save
```

---

#### 3. `prompt-updater.agent.md`

**Status**: üîÑ UPDATE - Add change categorization

**Current File**: `.github/agents/prompt-updater.agent.md` (699 lines)

**Updates Needed**:

| Section | Current | Add/Modify |
|---------|---------|------------|
| **Change planning** | List-based | Add impact categorization |
| **Risk assessment** | Implicit | Make explicit per-change |

**New Change Categorization to Add**:

```markdown
### Change Impact Categories (NEW)

**Classify each change before applying**:

| Category | Description | Approval Needed |
|----------|-------------|-----------------|
| **Structural** | Adds/removes sections, changes phase flow | Yes |
| **Behavioral** | Modifies boundaries, tool access | Yes |
| **Cosmetic** | Formatting, wording improvements | No |
| **Fix** | Corrects errors identified in validation | No |

**Update Plan Template**:
```markdown
### Change 1: [Description]
- **Type**: [Structural/Behavioral/Cosmetic/Fix]
- **Impact**: [High/Medium/Low]
- **Approval**: [Required/Auto-apply]
- **Lines**: [N-M]
- **Before**: [excerpt]
- **After**: [excerpt]
```
```

---

#### 4. `prompt-validator.agent.md`

**Status**: üîÑ UPDATE - Add tool alignment checks

**Current File**: `.github/agents/prompt-validator.agent.md` (648 lines)

**Updates Needed**:

| Section | Current | Add/Modify |
|---------|---------|------------|
| **Tool validation** | Basic presence check | Add count and alignment validation |
| **Scoring** | Structure-focused | Add tool composition score |

**New Validation Checks to Add**:

```markdown
### Phase 3a: Tool Composition Validation (NEW)

**Checks**:
1. **Tool Count**: [count] 
   - ‚úÖ 3-7 tools: Optimal
   - ‚ö†Ô∏è <3 tools: May be insufficient
   - ‚ùå >7 tools: Tool clash risk - FAIL

2. **Agent/Tool Alignment**:
   - `agent: plan` + write tools ‚Üí ‚ùå FAIL
   - `agent: agent` + only read tools ‚Üí ‚ö†Ô∏è Warning (may be intentional)
   
3. **Tool Redundancy**:
   - Check for overlapping capabilities
   - Recommend consolidation if found

**Output: Tool Composition Score**
```markdown
### Tool Composition
- **Count**: [N] [‚úÖ/‚ö†Ô∏è/‚ùå]
- **Alignment**: [agent mode] + [tool types] [‚úÖ/‚ùå]
- **Redundancy**: [None/Minor/Significant]
- **Score**: [X]/100
```
```

---

### New Agents to CREATE (4 files)

---

#### 5. `agent-researcher.agent.md`

**Status**: ‚¨ú CREATE NEW

**Purpose**: Research specialist for agent file requirements and pattern discovery. Parallel to `prompt-researcher` but specialized for agent concerns.

#### Full Specification

```yaml
---
name: agent-researcher
description: "Research specialist for agent file requirements and pattern discovery with role challenge validation"
agent: plan
model: claude-sonnet-4.5
tools:
  - semantic_search    # Find similar agents and patterns
  - grep_search        # Search for specific patterns
  - read_file          # Read templates and context files
  - file_search        # Locate agent files
  - list_dir           # Explore agent directory
handoffs:
  - label: "Build Agent"
    agent: agent-builder
    send: false
---
```

#### Role Definition

```markdown
# Agent Researcher

You are a **research specialist** focused on analyzing agent requirements and discovering implementation patterns. You excel at challenging role definitions with use cases, identifying tool requirements, and validating agent/tool alignment. You NEVER create or modify files‚Äîyou only research and report.

## Your Expertise

- **Role Challenge Analysis**: Testing agent roles against realistic scenarios
- **Tool Discovery**: Identifying minimum essential tools from use cases
- **Pattern Recognition**: Finding similar agents and extracting patterns
- **Alignment Validation**: Ensuring agent mode matches tool requirements
- **Scope Definition**: Identifying IN SCOPE vs OUT OF SCOPE boundaries
```

#### Key Processes

```markdown
## Process

### Phase 1: Requirements Clarification with Role Challenge

1. **Understand Primary Role**
   - What specialist persona is needed?
   - What tasks will this agent handle?
   - What mode: read-only analysis (plan) or active modification (agent)?

2. **Challenge Role with Use Cases**
   - Generate 3-7 scenarios based on complexity
   - Test each: Can this role handle effectively?
   - Identify gaps, overlaps, ambiguities
   - Discover tool requirements from scenarios
   - Find handoff needs (when to delegate)

3. **Validate Tool Requirements**
   - Map responsibilities ‚Üí capabilities ‚Üí tools
   - Enforce 3-7 tool limit (decompose if >7)
   - Verify agent/tool alignment:
     - `agent: plan` ‚Üí ONLY read-only tools
     - `agent: agent` ‚Üí read + write tools allowed

**Output: Validated Requirements**
```markdown
### Agent Requirements Summary

**Role**: [refined specialist role]
**Mode**: [plan/agent]
**Complexity**: [Simple/Moderate/Complex]

**Use Case Challenge Results**:
- [Use case 1]: [result]
- [Use case 2]: [result]
- [N more...]

**Tool Requirements** (3-7 only):
1. [tool-name] - [justification from use case]
2. [tool-name] - [justification from use case]
...

**Scope Boundaries**:
- IN SCOPE: [what agent handles]
- OUT OF SCOPE: [what's excluded or delegated]

**Handoffs Needed**: [other agents to coordinate with]

**Validation Status**: [‚úÖ/‚ö†Ô∏è/‚ùå]
```

### Phase 2: Pattern Discovery

[Same structure as prompt-researcher Phase 2, but searching .github/agents/]

### Phase 3: Structure Definition

[Same structure as prompt-researcher Phase 3, but with agent-specific fields]
```

#### Boundaries

```markdown
## üö® CRITICAL BOUNDARIES

### ‚úÖ Always Do
- Challenge EVERY role with at least 3 use cases
- Verify tool count is 3-7 (NEVER approve >7)
- Check agent/tool alignment (plan ‚Üí read-only only)
- Cross-reference tool-composition-guide.md
- Provide specific justification for each tool
- Identify scope boundaries clearly

### ‚ö†Ô∏è Ask First
- When role seems too broad (suggest decomposition)
- When >7 tools seem needed (MUST decompose)
- When agent/tool alignment is ambiguous

### üö´ Never Do
- NEVER create or modify files
- NEVER skip role challenge phase
- NEVER approve >7 tools
- NEVER mix `agent: plan` with write tools
- NEVER proceed to building without validated requirements
```

---

#### 6. `agent-builder.agent.md`

**Status**: ‚¨ú CREATE NEW

**Purpose**: File creation specialist for agent files. Parallel to `prompt-builder`.

#### Full Specification

```yaml
---
name: agent-builder
description: "Agent file generator following validated patterns and templates"
agent: agent
model: claude-sonnet-4.5
tools:
  - read_file          # Load templates and context
  - semantic_search    # Find similar patterns
  - create_file        # Create new agent file
  - file_search        # Locate reference files
handoffs:
  - label: "Validate Agent"
    agent: agent-validator
    send: true
---
```

#### Role Definition

```markdown
# Agent Builder

You are an **agent generation specialist** focused on creating high-quality agent files from validated specifications. You excel at implementing role definitions, configuring tools, and establishing clear boundaries. You create new files but do NOT modify existing agents.

## Your Expertise

- **Role Implementation**: Translating role specifications into agent personas
- **Tool Configuration**: Setting up 3-7 essential tools with proper alignment
- **Boundary Definition**: Creating comprehensive three-tier boundaries
- **Pattern Application**: Following repository conventions and templates
```

#### Boundaries

```markdown
## üö® CRITICAL BOUNDARIES

### ‚úÖ Always Do
- Verify specification has validated requirements
- Check tool count is 3-7 before creating
- Verify agent/tool alignment before saving
- Include complete three-tier boundaries
- Add bottom metadata block
- Hand off to validator automatically

### ‚ö†Ô∏è Ask First
- When specification seems incomplete
- When tool count is at boundary (3 or 7)
- When handoff targets don't exist yet

### üö´ Never Do
- NEVER modify existing agents (updater's role)
- NEVER create agent with >7 tools
- NEVER mix plan mode with write tools
- NEVER skip validation handoff
```

---

#### 7. `agent-updater.agent.md`

**Status**: ‚¨ú CREATE NEW

**Purpose**: Update specialist for existing agent files. Parallel to `prompt-updater`.

#### Full Specification

```yaml
---
name: agent-updater
description: "Specialized updater for existing agent files with tool alignment preservation"
agent: agent
model: claude-sonnet-4.5
tools:
  - read_file                    # Read current state
  - grep_search                  # Find patterns to update
  - replace_string_in_file       # Single updates
  - multi_replace_string_in_file # Batch updates
handoffs:
  - label: "Re-validate After Update"
    agent: agent-validator
    send: true
---
```

#### Key Processes

```markdown
## Process

### Phase 1: Update Planning

1. **Analyze Update Request**
   - Validation report with issues?
   - User-specified changes?
   - Tool realignment needed?

2. **Read Current Agent**
   - Load complete file
   - Parse YAML (tools, mode, handoffs)
   - Verify line numbers from validation report

3. **Plan Updates with Impact Assessment**
   - Categorize each change (Structural/Behavioral/Cosmetic/Fix)
   - Check: Will update break agent/tool alignment?
   - Check: Will update exceed 7-tool limit?
   - If either: STOP, report issue, ask for guidance

### Phase 2: Apply Updates

[Same as prompt-updater but with agent-specific validations]

### Phase 3: Post-Update Verification

**Before handoff to validator, verify**:
- [ ] Tool count still 3-7
- [ ] Agent/tool alignment preserved
- [ ] Boundaries still three-tier complete
- [ ] Handoff targets still valid
```

#### Boundaries

```markdown
## üö® CRITICAL BOUNDARIES

### ‚úÖ Always Do
- Read complete file before any changes
- Verify agent/tool alignment after changes
- Verify tool count remains 3-7
- Include 3-5 lines context in replacements
- Hand off to validator for re-validation

### ‚ö†Ô∏è Ask First
- Before changes that affect tool count
- Before changes that affect agent mode
- Before removing or adding handoffs

### üö´ Never Do
- NEVER create new files
- NEVER update without reading first
- NEVER break agent/tool alignment
- NEVER exceed 7-tool limit
- NEVER skip re-validation
```

---

#### 8. `agent-validator.agent.md`

**Status**: ‚¨ú CREATE NEW

**Purpose**: Quality assurance specialist for agent files. Parallel to `prompt-validator` with agent-specific checks.

#### Full Specification

```yaml
---
name: agent-validator
description: "Quality assurance specialist for agent file validation with tool alignment verification"
agent: plan
model: claude-sonnet-4.5
tools:
  - read_file      # Load files to validate
  - grep_search    # Search for patterns
  - file_search    # Find reference files
---
```

#### Key Validation Checks

```markdown
## Validation Checks

### Agent-Specific Checks (Priority)

1. **Tool Count Validation** (CRITICAL)
   - Count tools in YAML array
   - ‚ùå FAIL if >7 tools
   - ‚ö†Ô∏è WARN if <3 tools
   - ‚úÖ PASS if 3-7 tools

2. **Agent/Tool Alignment** (CRITICAL)
   - Parse `agent:` field
   - Parse `tools:` array
   - Check alignment:
     - `agent: plan` + ANY write tool ‚Üí ‚ùå FAIL
     - `agent: agent` + only read tools ‚Üí ‚ö†Ô∏è WARN
     - Proper alignment ‚Üí ‚úÖ PASS
   - Write tools: create_file, replace_string_in_file, multi_replace_string_in_file, run_in_terminal

3. **Handoff Validity**
   - Parse `handoffs:` array
   - For each handoff target:
     - Check if target agent file exists
     - Verify target is valid agent name
   - ‚ùå FAIL if any target doesn't exist

4. **Role/Persona Validation**
   - Check for clear role definition section
   - Verify expertise areas defined
   - Check for specialist focus (not generic)

### Standard Checks (Same as prompt-validator)
- Structure validation
- Convention compliance  
- Pattern consistency
- Quality assessment
```

#### Output Format

```markdown
### Validation Report: [agent-name]

**Overall Status**: [‚úÖ PASSED / ‚ö†Ô∏è WARNINGS / ‚ùå FAILED]

**Agent-Specific Checks**:
| Check | Result | Details |
|-------|--------|---------|
| Tool Count | [‚úÖ/‚ö†Ô∏è/‚ùå] | [N] tools (3-7 required) |
| Agent/Tool Alignment | [‚úÖ/‚ö†Ô∏è/‚ùå] | [mode] + [tool types] |
| Handoff Validity | [‚úÖ/‚ö†Ô∏è/‚ùå] | [N] handoffs, [M] valid |
| Role Definition | [‚úÖ/‚ö†Ô∏è/‚ùå] | [assessment] |

**Standard Checks**:
| Check | Score | Details |
|-------|-------|---------|
| Structure | [X]/100 | [findings] |
| Conventions | [X]/100 | [findings] |
| Patterns | [X]/100 | [findings] |
| Quality | [X]/100 | [findings] |

**Issues by Severity**:
- **Critical** ([N]): [list with line numbers]
- **Moderate** ([N]): [list with line numbers]
- **Minor** ([N]): [list with line numbers]

**Recommendations**:
1. [Specific fix with line reference]
2. [Specific fix with line reference]
```

---

## Instruction Files Assessment

### `.github/instructions/prompts.instructions.md`

**Status**: ‚úÖ NO CHANGES NEEDED

**Assessment**: Current file is comprehensive and covers:
- Context engineering principles reference
- Tool selection guidance
- Repository-specific patterns
- Naming conventions
- Template references

### `.github/instructions/agents.instructions.md`

**Status**: ‚úÖ NO CHANGES NEEDED

**Assessment**: Current file is comprehensive and covers:
- Context engineering principles reference
- Tool selection (3-7 tool rule documented)
- Agent/tool alignment guidance
- Six essential agent patterns
- Multi-agent orchestration guidance

---

## Handoff Flow Diagrams

### Prompt Design and Create Flow

```
User Request
    ‚îÇ
    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 PHASE 1: Requirements                       ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  Orchestrator ‚îÄ‚îÄ‚ñ∫ prompt-researcher (challenge with cases) ‚îÇ
‚îÇ       ‚îÇ                    ‚îÇ                                ‚îÇ
‚îÇ       ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò Requirements Report            ‚îÇ
‚îÇ       ‚îÇ                                                     ‚îÇ
‚îÇ       ‚ñº                                                     ‚îÇ
‚îÇ  [User Approval Checkpoint]                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ
    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 PHASE 2: Research                           ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  Orchestrator ‚îÄ‚îÄ‚ñ∫ prompt-researcher (pattern discovery)    ‚îÇ
‚îÇ       ‚îÇ                    ‚îÇ                                ‚îÇ
‚îÇ       ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò Pattern Report                 ‚îÇ
‚îÇ       ‚îÇ                                                     ‚îÇ
‚îÇ       ‚ñº                                                     ‚îÇ
‚îÇ  [User Approval Checkpoint]                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ
    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 PHASE 3: Structure                          ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  Orchestrator ‚îÄ‚îÄ‚ñ∫ prompt-researcher (define structure)     ‚îÇ
‚îÇ       ‚îÇ                    ‚îÇ                                ‚îÇ
‚îÇ       ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò Specification                  ‚îÇ
‚îÇ       ‚îÇ                                                     ‚îÇ
‚îÇ       ‚ñº                                                     ‚îÇ
‚îÇ  [User Approval Checkpoint]                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ
    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 PHASE 4: Build                              ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  Orchestrator ‚îÄ‚îÄ‚ñ∫ prompt-builder (create file)             ‚îÇ
‚îÇ       ‚îÇ                    ‚îÇ                                ‚îÇ
‚îÇ       ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò File Created                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ
    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ            PHASE 5-6: Agent Plans (if needed)               ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  If agents to update: Create plan ‚îÄ‚îÄ‚ñ∫ agent-review-validate ‚îÇ
‚îÇ  If agents to create: Create plan ‚îÄ‚îÄ‚ñ∫ agent-design-create   ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  [User Approval Checkpoint for each plan]                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ
    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 PHASE 7: Validation                         ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  Orchestrator ‚îÄ‚îÄ‚ñ∫ prompt-validator (AUTO handoff)          ‚îÇ
‚îÇ       ‚îÇ                    ‚îÇ                                ‚îÇ
‚îÇ       ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò Validation Report              ‚îÇ
‚îÇ       ‚îÇ                                                     ‚îÇ
‚îÇ       ‚ñº                                                     ‚îÇ
‚îÇ  [Decision: Pass/Warn/Fail]                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ If PASS             ‚îÇ If FAIL
    ‚ñº                      ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   COMPLETE   ‚îÇ    ‚îÇ         PHASE 8: Fix Issues            ‚îÇ
‚îÇ   ‚úÖ          ‚îÇ    ‚îÇ                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ  Orchestrator ‚îÄ‚îÄ‚ñ∫ prompt-updater       ‚îÇ
                    ‚îÇ       ‚îÇ                    ‚îÇ            ‚îÇ
                    ‚îÇ       ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò Updated    ‚îÇ
                    ‚îÇ       ‚îÇ                                 ‚îÇ
                    ‚îÇ       ‚ñº                                 ‚îÇ
                    ‚îÇ  [Loop back to Phase 7, max 3x]         ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Agent Design and Create Flow

```
User Request
    ‚îÇ
    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 PHASE 1: Requirements                       ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  Orchestrator ‚îÄ‚îÄ‚ñ∫ agent-researcher (role challenge)        ‚îÇ
‚îÇ       ‚îÇ                    ‚îÇ                                ‚îÇ
‚îÇ       ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò Requirements (tools 3-7)       ‚îÇ
‚îÇ       ‚îÇ                                                     ‚îÇ
‚îÇ       ‚ñº                                                     ‚îÇ
‚îÇ  [User Approval + Tool Count Verification]                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ
    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 PHASE 2-3: Research + Structure             ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  [Same as Prompt flow but with agent-specific checks]       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ
    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 PHASE 4: Build                              ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  Orchestrator ‚îÄ‚îÄ‚ñ∫ agent-builder (create file)              ‚îÇ
‚îÇ       ‚îÇ                    ‚îÇ                                ‚îÇ
‚îÇ       ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò File + Tool Count Verification ‚îÇ
‚îÇ       ‚îÇ                                                     ‚îÇ
‚îÇ       ‚îÇ  ‚ö†Ô∏è GATE: If tools >7, REJECT and go back          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ
    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ            PHASE 5-6: Agent Dependencies                    ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  If agents to update ‚îÄ‚îÄ‚ñ∫ agent-review-and-validate         ‚îÇ
‚îÇ  If agents to create ‚îÄ‚îÄ‚ñ∫ RECURSIVE agent-design-and-create ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  ‚ö†Ô∏è Max recursion depth: 2 levels                          ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  [User Approval Required for each]                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ
    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 PHASE 7: Validation                         ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  Orchestrator ‚îÄ‚îÄ‚ñ∫ agent-validator (AUTO)                   ‚îÇ
‚îÇ       ‚îÇ                    ‚îÇ                                ‚îÇ
‚îÇ       ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò Report + Tool Alignment Check  ‚îÇ
‚îÇ       ‚îÇ                                                     ‚îÇ
‚îÇ       ‚îÇ  ‚ö†Ô∏è CRITICAL: Fail if tools >7 or alignment wrong  ‚îÇ
‚îÇ       ‚ñº                                                     ‚îÇ
‚îÇ  [Decision: Pass/Warn/Fail]                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ If PASS             ‚îÇ If FAIL
    ‚ñº                      ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   COMPLETE   ‚îÇ    ‚îÇ         PHASE 8: Fix Issues            ‚îÇ
‚îÇ   ‚úÖ          ‚îÇ    ‚îÇ                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ  Orchestrator ‚îÄ‚îÄ‚ñ∫ agent-updater        ‚îÇ
                    ‚îÇ       ‚îÇ                                 ‚îÇ
                    ‚îÇ       ‚îÇ  ‚ö†Ô∏è Preserve tool alignment     ‚îÇ
                    ‚îÇ       ‚îÇ  ‚ö†Ô∏è Maintain 3-7 tool count     ‚îÇ
                    ‚îÇ       ‚îÇ                                 ‚îÇ
                    ‚îÇ       ‚ñº                                 ‚îÇ
                    ‚îÇ  [Loop back to Phase 7, max 3x]         ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## Implementation Roadmap

### Stage 1: Agent Infrastructure (Week 1, Days 1-3)

**Priority**: CRITICAL - Agents are dependencies for orchestrators

| Day | Task | Output |
|-----|------|--------|
| 1 | Create `agent-researcher.agent.md` | Agent file with role challenge capabilities |
| 1 | Create `agent-validator.agent.md` | Agent file with tool alignment checks |
| 2 | Create `agent-builder.agent.md` | Agent file with tool count verification |
| 2 | Create `agent-updater.agent.md` | Agent file with alignment preservation |
| 3 | Test all 4 agents independently | Test results documented |

### Stage 2: Update Existing Prompt Agents (Week 1, Days 3-4)

**Priority**: HIGH - Enhance existing agents with v2 capabilities

| Day | Task | Output |
|-----|------|--------|
| 3 | Update `prompt-researcher.agent.md` | Added use case challenge methodology |
| 3 | Update `prompt-validator.agent.md` | Added tool alignment validation |
| 4 | Update `prompt-builder.agent.md` | Added pre-save validation |
| 4 | Update `prompt-updater.agent.md` | Added change categorization |

### Stage 3: Create Orchestration Prompts (Week 1-2, Days 5-8)

**Priority**: MEDIUM - Build on agent infrastructure

| Day | Task | Output |
|-----|------|--------|
| 5 | Create `agent-design-and-create.prompt.md` | Full orchestrator with Phase 1-8 |
| 6 | Create `agent-review-and-validate.prompt.md` | Validation orchestrator |
| 7 | Update `prompt-design-and-create.prompt.md` | Enhanced with Phase 5-6 |
| 8 | Update `prompt-review-and-validate.prompt.md` | Minor enhancements |

### Stage 4: Integration Testing (Week 2, Days 9-10)

| Day | Task | Output |
|-----|------|--------|
| 9 | End-to-end test: Create test prompt | Working prompt file |
| 9 | End-to-end test: Create test agent | Working agent file |
| 10 | End-to-end test: Validation workflows | Both review-validate prompts working |
| 10 | End-to-end test: Agent dependencies | Phase 5-6 agent plans work |

### Stage 5: Documentation and Migration (Week 2, Days 11-12)

| Day | Task | Output |
|-----|------|--------|
| 11 | Add deprecation notices to v2 files | Notices pointing to new workflows |
| 11 | Update this planning document | Mark stages complete |
| 12 | Team training documentation | Usage guide for new workflows |
| 12 | Update tech/ articles | References to new system |

---

## Success Criteria

### Reliability Metrics

| Metric | Target | Measurement |
|--------|--------|-------------|
| Agent tool count | 100% agents have 3-7 tools | YAML validation |
| Tool alignment | 100% agents pass alignment check | Validator reports |
| Validation pass rate | 90%+ first-time pass | Track Phase 7 results |
| Issue resolution cycles | ‚â§2 loops to resolution | Track Phase 7‚Üî8 iterations |

### Quality Metrics

| Metric | Target | Measurement |
|--------|--------|-------------|
| Use case coverage | 100% of roles challenged | Phase 1 completion |
| Boundary completeness | 100% have three-tier | Validator check |
| Template compliance | 100% follow patterns | Pattern consistency score |

### Workflow Metrics

| Metric | Target | Measurement |
|--------|--------|-------------|
| Time to create prompt | <15 minutes | Time tracking |
| Time to create agent | <20 minutes | Time tracking |
| User approval rate | >90% plans approved as-is | Phase transition tracking |

---

## File Checklist Summary

### Orchestration Prompts

| File | Status | Action |
|------|--------|--------|
| `prompt-design-and-create.prompt.md` | üîÑ | UPDATE (add Phase 5-6) |
| `prompt-review-and-validate.prompt.md` | üîÑ | UPDATE (minor) |
| `agent-design-and-create.prompt.md` | ‚¨ú | CREATE NEW |
| `agent-review-and-validate.prompt.md` | ‚¨ú | CREATE NEW |

### Agent Files - Existing (Prompt)

| File | Status | Action |
|------|--------|--------|
| `prompt-researcher.agent.md` | üîÑ | UPDATE (add use case challenge) |
| `prompt-builder.agent.md` | üîÑ | UPDATE (add pre-save validation) |
| `prompt-updater.agent.md` | üîÑ | UPDATE (add change categorization) |
| `prompt-validator.agent.md` | üîÑ | UPDATE (add tool alignment) |

### Agent Files - New (Agent)

| File | Status | Action |
|------|--------|--------|
| `agent-researcher.agent.md` | ‚¨ú | CREATE NEW |
| `agent-builder.agent.md` | ‚¨ú | CREATE NEW |
| `agent-updater.agent.md` | ‚¨ú | CREATE NEW |
| `agent-validator.agent.md` | ‚¨ú | CREATE NEW |

### Instruction Files

| File | Status | Action |
|------|--------|--------|
| `prompts.instructions.md` | ‚úÖ | NO CHANGES |
| `agents.instructions.md` | ‚úÖ | NO CHANGES |

### Files to Deprecate (After Validation)

| File | Status | Migration Path |
|------|--------|----------------|
| `agent-createorupdate-agent-file-v2.prompt.md` | üì¶ | ‚Üí `agent-design-and-create.prompt.md` |
| `prompt-createorupdate-prompt-file-v2.prompt.md` | üì¶ | ‚Üí `prompt-design-and-create.prompt.md` |

---

## Next Steps

### Immediate Actions

1. ‚úÖ **Review this plan** - Approve architecture and approach
2. ‚¨ú **Create `agent-researcher.agent.md`** - First new agent
3. ‚¨ú **Create `agent-validator.agent.md`** - Second new agent
4. ‚¨ú **Create `agent-builder.agent.md`** - Third new agent
5. ‚¨ú **Create `agent-updater.agent.md`** - Fourth new agent

### Upon Plan Approval

Execute Stage 1-5 following the implementation roadmap above.

---

**Document Version**: 2.0  
**Created**: 2025-12-14  
**Last Updated**: 2025-12-14  
**Status**: Ready for Review  
**Author**: GitHub Copilot (Claude Opus 4.5)

<!-- 
---
article_metadata:
  filename: "10. prompt creation multiagent flow-v2.md"
  type: "technical-plan"
  last_updated: "2025-12-14T00:00:00Z"
  version: "2.0"
  status: "planning"
---
-->
