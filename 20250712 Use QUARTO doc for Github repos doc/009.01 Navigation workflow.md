# Navbars Navigation Workflow - Complete Guide

## Overview
This document covers the complete navigation workflow for Quarto sites, including automated navigation generation, Related Pages functionality, and integration with GitHub Pages deployment.

## Navigation Architecture

### Components Overview

```
Quarto Navigation System
??? _quarto.yml                    # Source configuration
??? navigation.json                # Generated navigation data  
??? GitHub Pages                   # Deployed site
?   ??? Left Sidebar              # Main navigation
?   ??? Top Navbar                # Site-wide navigation
?   ??? Right Margin              # Related Pages (custom)
??? Build Process
    ??? Pre-render hooks          # Data generation
    ??? GitHub Actions            # Automated deployment
    ??? Client-side JavaScript    # Dynamic features
```

### Navigation Data Flow

1. **Configuration** ? `_quarto.yml` defines site structure
2. **Generation** ? `scripts/generate-navigation.ps1` creates `navigation.json`
3. **Build** ? Quarto renders HTML with navigation structure
4. **Enhancement** ? Client-side JavaScript adds Related Pages
5. **Deployment** ? GitHub Pages serves complete navigation

## Automated Navigation.json Generation

### How It Works

The `navigation.json` file powers the Related Pages functionality and is automatically generated from `_quarto.yml`:

- **When**: Only when `navigation.json` is missing or older than `_quarto.yml`
- **Where**: Generated by `scripts/generate-navigation.ps1`
- **Trigger**: Pre-render hook in `_quarto.yml`

### Smart Generation Process

```powershell
# Timestamp-based intelligent regeneration
if ($quartoModified -gt $navModified) {
    Write-Host "navigation.json is older than _quarto.yml - will regenerate"
    $shouldGenerate = $true
} else {
    Write-Host "navigation.json is up to date - skipping generation"
    $shouldGenerate = $false
}
```

### Technical Implementation

**yq Command Used:**
```bash
yq eval '.website.sidebar.contents' _quarto.yml --output-format=json
```

**PowerShell Processing:**
```powershell
# Extract content and wrap in navigation structure
$extractedContent = & $yqExecutable eval '.website.sidebar.contents' $quartoFile --output-format=json
$navigationStructure = @{
    contents = $extractedContent | ConvertFrom-Json
}
$navigationStructure | ConvertTo-Json -Depth 20 | Out-File -FilePath $navFile
```

## Navbar Configuration

### Top-Level Navigation

The navbar provides site-wide navigation and branding:

```yaml
website:
  navbar:
    background: primary
    search: true
    title: "Learning Hub"
    left:
      - icon: house-fill
        href: index.qmd
        text: "Home"
      - text: "Events"
        menu:
          - href: "202506 Build 2025/Readme.md"
            text: "Build 2025: Conference Overview"
    right:
      - icon: github
        href: "https://github.com/darioairoldi/Learn"
        aria-label: "GitHub Repository"
```

**Key Features:**

- **Responsive design**: Collapses to hamburger menu on mobile
- **Search integration**: Built-in site search functionality
- **Menu dropdowns**: Hierarchical navigation structure
- **Icon support**: Font Awesome and custom icons
- **External links**: Direct links to repositories and resources

## Sidebar Navigation

### Structure and Behavior

The sidebar provides detailed site navigation with collapsible sections:

```yaml
website:
  sidebar:
    style: "floating"      # or "docked"
    search: true
    collapse-level: 3
    contents:
      - href: index.qmd
        text: "Home"
        icon: house-fill
      - section: "Events"
        icon: calendar-event
        contents:
          # Nested navigation structure
```

**Advanced Features:**

- **Floating vs Docked**: Different visual styles
- **Collapse levels**: Control automatic section expansion
- **Search integration**: Filter navigation items
- **Icons**: Visual indicators for sections
- **Active state tracking**: Highlights current page

### Dynamic Navigation Updates

The sidebar responds to page changes and user interaction:

```javascript
// Listen for sidebar navigation clicks
document.addEventListener('click', function(event) {
    const sidebarItem = event.target.closest('.sidebar-item-text, .nav-link');
    if (sidebarItem && sidebarItem.closest('#quarto-sidebar')) {
        // Update Related Pages based on new selection
        setTimeout(renderRightNav, 100);
    }
});
```

## Related Pages Implementation

### Architecture Overview

The Related Pages feature extends Quarto's native navigation with intelligent content discovery:

**File Structure:**
```
??? _includes/right-nav.html              # Related Pages widget
??? scripts/generate-navigation.ps1       # Data generator
??? navigation.json                       # Navigation structure
??? _quarto.yml                          # Integration configuration
```

### Client-Side Intelligence

**Page Context Detection:**
```javascript
function getCurrentPagePath() {
    let path = window.location.pathname;
    // Normalize path for GitHub Pages
    if (path.startsWith('Learn/')) {
        path = path.substring(5);
    }
    return path.replace('.html', '').replace(/^\//, '');
}
```

**Navigation Logic:**

- **Section pages**: Show first-level children (subsections)
- **Leaf pages**: Show all siblings including current page
- **Active highlighting**: Mark current page in Related Pages

### Integration Points

**Quarto Configuration:**
```yaml
format:
  html:
    include-after-body: 
      - _includes/right-nav.html
    grid:
      margin-width: 280px    # Space for Related Pages
```

**Responsive Behavior:**
```css
@media (max-width: 800px) {
    #custom-right-nav {
        display: none; /* Hide on mobile */
    }
}
```

## Development Workflows

### Local Development Options

**Option 1: Development Script**
```bash
./dev-serve.bat
```

**Option 2: Manual Commands**
```powershell
# Generate navigation.json (if needed)
powershell -ExecutionPolicy Bypass -File scripts/generate-navigation.ps1
# Start Quarto preview
quarto preview
```

**Option 3: Standard Quarto (with pre-render hook)**
```bash
quarto render    # Automatically runs pre-render hook
quarto preview   # Live development server
```

### GitHub Pages Deployment

**Pre-render Integration:**
```yaml
project:
  pre-render: 
    - powershell -ExecutionPolicy Bypass -File scripts/generate-navigation.ps1
```

**Workflow Integration:**
The GitHub Actions workflow handles:
1. **Environment setup**: Quarto installation
2. **Pre-render execution**: Navigation generation
3. **Site building**: HTML generation
4. **Deployment**: GitHub Pages publishing

## File Management Strategy

### Versioning Strategy

| File | Purpose | Versioned | Reason |
|------|---------|-----------|---------|
| **navigation.json** | Navigation data | ? Yes | Ensures consistency across environments |
| **scripts/generate-navigation.ps1** | Generator script | ? Yes | Source code for automation |
| **yq.exe** | YAML processor | ? No | Auto-downloaded dependency |

### Render Configuration

**Comprehensive File Inclusion:**
```yaml
render:
  - "*.qmd"           # Quarto documents
  - "*.md"            # Markdown files
  - "*/README.md"     # Directory documentation
  - "**/README.md"    # Recursive documentation
  - "**/SUMMARY.md"   # Summary files
  - "**/*.md"         # All markdown files
```

This ensures all referenced files in navigation are properly rendered and available.

## Troubleshooting Guide

### Common Issues and Solutions

**404 Errors on Navigation Links:**

- ? **Check render configuration**: Ensure files are included in render list
- ? **Verify file existence**: Confirm source files exist
- ? **Case sensitivity**: GitHub Pages is case-sensitive
- ? **URL encoding**: Special characters need proper encoding

**Navigation Generation Failures:**
```powershell
# Manual testing
powershell -ExecutionPolicy Bypass -File scripts/generate-navigation.ps1

# Check yq availability
.\yq.exe --version

# Verify _quarto.yml syntax
yq eval '.' _quarto.yml
```

**GitHub Actions Issues:**

- ? **Pre-render hook syntax**: Use full PowerShell command
- ? **File permissions**: Ensure scripts are executable
- ? **Path handling**: Use correct file paths for cross-platform compatibility

### Debugging Client-Side Issues

**Console Debugging:**
```javascript
// Enable verbose logging
console.log('?? Current page path:', getCurrentPagePath());
console.log('?? Navigation config loaded:', navigationConfig);
console.log('?? Found siblings:', siblings);
```

**Network Debugging:**

- Check navigation.json loads correctly in browser
- Verify file is deployed to GitHub Pages
- Confirm JSON structure is valid

## Performance Optimization

### Build Performance

- **Smart regeneration**: Only rebuild navigation.json when needed
- **Timestamp checking**: Avoid unnecessary work
- **Cached dependencies**: yq.exe downloaded once per environment

### Runtime Performance

- **Lazy loading**: Related Pages loads after main content
- **Event delegation**: Efficient navigation event handling
- **Responsive design**: Mobile optimization reduces complexity

### SEO and Accessibility

**Navigation Structure:**

- **Semantic HTML**: Proper navigation landmarks
- **ARIA labels**: Accessibility-friendly navigation
- **SEO-friendly URLs**: Clean, descriptive paths
- **Sitemap generation**: Automatic via Quarto

## Advanced Configuration

### Custom Navigation Patterns

**Conditional Navigation:**
```yaml
sidebar:
  contents:
    - text: "---"        # Separator
    - section: "Advanced"
      contents:
        - href: advanced/topic1.md
          text: "Topic 1"
      collapse: true       # Start collapsed
```

**Dynamic Menu Generation:**
The Related Pages system can be extended for:
- **Tag-based navigation**: Show related content by tags
- **Category filtering**: Filter by content categories
- **Search integration**: Connect with site search
- **Breadcrumb generation**: Show navigation path

### Integration with External Systems

**API Integration:**
```javascript
// Example: Load dynamic navigation from CMS
async function loadDynamicNavigation() {
    const response = await fetch('/api/navigation');
    const dynamicNav = await response.json();
    renderDynamicNavigation(dynamicNav);
}
```

This comprehensive navigation workflow ensures a seamless user experience while providing developers with powerful tools for customization and automation.